plugins {
  id 'org.springframework.boot' version '2.3.0.RELEASE'
  id 'io.spring.dependency-management' version '1.0.9.RELEASE'
  id "org.asciidoctor.convert" version "1.5.3"
  id 'java'
}

group = 'io.spring'
version = '0.0.1-SNAPSHOT'
sourceCompatibility = 11
targetCompatibility = 11

configurations {
  developmentOnly
  runtimeClasspath {
    extendsFrom developmentOnly
  }
  compileOnly {
    extendsFrom annotationProcessor
  }
}

repositories {
  mavenCentral()
}


dependencies {
  implementation('org.springframework.boot:spring-boot-starter-validation')
  implementation('org.springframework.boot:spring-boot-starter-data-jpa')
  implementation('org.springframework.boot:spring-boot-starter-hateoas')
  implementation('org.springframework.boot:spring-boot-starter-web')
  implementation 'org.modelmapper:modelmapper:2.3.1'
  implementation 'org.springframework.security.oauth.boot:spring-security-oauth2-autoconfigure:2.1.0.RELEASE'
  implementation 'com.github.gavlyukovskiy:p6spy-spring-boot-starter:1.6.1'
  developmentOnly('org.springframework.boot:spring-boot-devtools')
  runtimeOnly('com.h2database:h2')
  runtimeOnly('org.postgresql:postgresql')
  annotationProcessor('org.projectlombok:lombok')
  testImplementation('org.springframework.boot:spring-boot-starter-test')
  testImplementation('org.springframework.restdocs:spring-restdocs-mockmvc')
  testImplementation 'pl.pragmatists:JUnitParams:1.1.1'
  testImplementation 'org.springframework.security:spring-security-test'

  annotationProcessor "org.springframework.boot:spring-boot-configuration-processor"
  asciidoctor "org.springframework.restdocs:spring-restdocs-asciidoctor"
}

ext {
  snippetsDir = file('build/generated-snippets')
}

test {
  outputs.dir snippetsDir
}

asciidoctor {
  inputs.dir snippetsDir
  dependsOn test
}

task copyDocument(type: Copy) {
  dependsOn asciidoctor

  from file('build/asciidoc/html5/')
  into file('src/main/resources/static/docs')
  into file('build/resources/main/static/docs')
}

build {
  dependsOn copyDocument
}

compileJava.dependsOn(processResources)